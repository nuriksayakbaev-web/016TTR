# Рекомендации по развитию 016TTR

## Что уже сделано (этап)

- **БД**: добавлены индексы по датам, статусу, `invoice_number`; миграция `supabase/migrations/002_indexes_for_scale.sql`.
- **Унификация CRUD**: `lib/supabaseService.ts` — `selectTable`, `selectCount`, `insertRow`, `updateRow`, `deleteRow` с логированием ошибок в console.
- **Пагинация**: серверная на странице счетов (page, limit в URL), сброс страницы при смене фильтров.
- **Фильтры в URL**: статус и даты в query; можно шарить ссылку и обновлять без потери фильтра.
- **Toast**: `lib/toast.tsx` + `useToast()` — успех/ошибка без сторонних библиотек.
- **Защита удаления**: `confirm()` перед удалением счёта.
- **Inline-редактирование**: статус счёта — клик по Badge → Select → сохранение через `updateRow`.
- **Empty state**: компонент `components/empty-state.tsx`, использован в таблице счетов.
- **Excel**: универсальный `downloadExcel`; `exportTableChunked` — выгрузка по частям (по 2000 строк) с учётом текущих фильтров; две кнопки — «Экспорт страницы» и «Экспорт всего».

## Дальнейший рост без выхода за лимиты

1. **Остальные модули**  
   Подключить тот же паттерн: фильтры в URL, пагинация через `?page=`, список через RSC, формы/таблицы — Client Components, мутации через `supabaseService` + toast.

2. **Типы и numeric/date**  
   В БД уже используются `NUMERIC` и `DATE`. На фронте везде приводить суммы через `Number()`, даты — через `toLocaleDateString("ru-RU")` или ISO. Не заводить лишних JOIN: все списки — по одной таблице.

3. **Производительность**  
   - Тяжёлые страницы (например, отчёты) оборачивать в `dynamic = "force-dynamic"` и при необходимости выносить в `React.lazy` + Suspense.  
   - Не запрашивать одни и те же данные дважды на одной странице; дашборд уже использует параллельные запросы.

4. **Надёжность**  
   - Все мутации через `supabaseService`: ошибки логируются в console и показываются в toast.  
   - Критичные места (оплата, удаление) оставлять с `confirm()`.

5. **Экспорт**  
   - Для других таблиц скопировать подход из счетов: колонки + `exportTableChunked` с тем же `fetchPage`, учитывающим фильтры из URL.  
   - При росте объёма (десятки тысяч строк) можно вынести экспорт в API Route и стримить файл, чтобы не держать всё в памяти браузера.

6. **Лимиты бесплатного тарифа**  
   - Supabase Free: 500 MB БД, 1 GB Storage — для одного пользователя и 50k записей по текущим таблицам достаточно.  
   - Vercel: лимиты по bandwidth и function invocations; избегать лишних тяжёлых запросов и больших ответов.

7. **Хук useTableData**  
   При появлении второго модуля с пагинацией и фильтрами можно вынести общую логику в хук: `useTableData(tableName, { page, pageSize, filters })` → `{ data, totalCount, totalPages, refresh }`. Серверные данные по-прежнему загружать в RSC и передавать в таблицу пропсами; хук нужен только для клиентского состояния (например, выбор строк) и вызова `router.refresh()` после мутаций.
